<!DOCTYPE html>
<html>
<head>
  <title>Next Hour</title>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>

  <div class="box">

    <h2>Next Hour</h2>
    <p>At your doorstep in 60 minutes</p>

    <!-- AUTH SECTION -->
    <div id="authSection">
      <input id="email" placeholder="Email">
      <input id="password" type="password" placeholder="Password">

      <select id="role">
        <option value="customer">Customer</option>
        <option value="seller">Seller</option>
      </select>

      <button onclick="signup()">Signup</button>
      <button onclick="login()">Login</button>
      <button onclick="googleLogin()">Continue with Google</button>
    </div>

    <!-- CUSTOMER DASHBOARD -->
    <div id="customerDashboard" class="hidden">
      <h3>Customer Dashboard</h3>
      <button onclick="logout()">Logout</button>
    </div>

    <!-- SELLER DASHBOARD -->
    <div id="sellerDashboard" class="hidden">
      <h3>Seller Dashboard</h3>
      <button onclick="logout()">Logout</button>
    </div>

  </div>

  <!-- SCRIPTS (VERY IMPORTANT PLACE) -->
  <script type="module" src="./firebase.js"></script>
  <script type="module" src="./auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // ðŸ”¥ FIREBASE CONFIG (PUT YOUR OWN)
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
  };

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();

  // SIGNUP
  function signup() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    const role = document.getElementById("role").value;

    auth.createUserWithEmailAndPassword(email, password)
      .then(res => {
        return db.collection("users").doc(res.user.uid).set({
          email,
          role
        });
      })
      .then(() => alert("Signup successful"))
      .catch(err => alert(err.message));
  }

  // LOGIN
  function login() {
    auth.signInWithEmailAndPassword(
      email.value,
      password.value
    ).catch(err => alert(err.message));
  }

  // GOOGLE LOGIN
  function googleLogin() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider)
      .then(res => {
        return db.collection("users").doc(res.user.uid).set({
          email: res.user.email,
          role: "customer"
        }, { merge: true });
      });
  }

  // LOGOUT
  function logout() {
    auth.signOut();
  }

  // AUTH STATE
  auth.onAuthStateChanged(user => {
    if (!user) return;

    db.collection("users").doc(user.uid).get().then(doc => {
      const role = doc.data().role;
      alert("Logged in as " + role);
    });
  });
</script>
</body>
</html>
