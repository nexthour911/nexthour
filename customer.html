<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Seller Dashboard</title>

<style>
body {
  font-family: system-ui, sans-serif;
  background:#f1f5f9;
  padding:20px;
}

.box {
  background:white;
  padding:20px;
  margin-bottom:20px;
  border-radius:10px;
  box-shadow:0 10px 25px rgba(0,0,0,.1);
}

input, select, button {
  width:100%;
  padding:8px;
  margin-top:8px;
}

button {
  cursor:pointer;
}

.danger { background:#dc2626;color:white;border:none; }
.success { background:#16a34a;color:white;border:none; }
.gray { background:#334155;color:white;border:none; }

li {
  background:#f8fafc;
  padding:10px;
  margin:8px 0;
  border-radius:6px;
}
</style>
</head>

<body>

<!-- ADD PRODUCT -->
<div class="box">
  <h2>Add Product</h2>
  <input id="name" placeholder="Product name">
  <input id="price" placeholder="Price" type="number">

  <select id="category">
    <option value="">Select category</option>
    <option>Men's wear</option>
    <option>Women's wear</option>
    <option>Kid's wear</option>
    <option>Street style</option>
    <option>Casuals</option>
    <option>Classy</option>
    <option>Formals</option>
    <option>Party wear</option>
  </select>

  <button class="success" onclick="addProduct()">Add Product</button>
</div>

<!-- CATEGORY FILTER -->
<div class="box">
  <h2>My Products</h2>

  <select id="sellerCategoryFilter">
    <option value="">All Categories</option>
    <option>Men's wear</option>
    <option>Women's wear</option>
    <option>Kid's wear</option>
    <option>Street style</option>
    <option>Casuals</option>
    <option>Classy</option>
    <option>Formals</option>
    <option>Party wear</option>
  </select>

  <ul id="productList"></ul>
</div>

<!-- ORDERS -->
<div class="box">
  <h2>Orders</h2>
  <ul id="orderList"></ul>
</div>

<button class="gray" onclick="logout()">Logout</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import {
  getFirestore, collection, addDoc, getDocs,
  query, where, deleteDoc, doc, updateDoc, serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBNR5Td6W_7TAjfRhoJzYrGJMgy3Ff_E1Q",
  authDomain: "nexthour-3248f.firebaseapp.com",
  projectId: "nexthour-3248f",
  appId: "1:83247480758:web:27f8f8507273d54ee44b17"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
let currentUser;

/* AUTH CHECK */
onAuthStateChanged(auth, user => {
  if (!user) location.href = "index.html";
  currentUser = user;
  loadProducts();
  loadOrders();
});

sellerCategoryFilter.onchange = loadProducts;

/* ADD PRODUCT */
window.addProduct = async () => {
  if (!name.value || !price.value || !category.value) {
    alert("Fill all fields");
    return;
  }

  await addDoc(collection(db,"products"), {
    name: name.value,
    price: price.value,
    category: category.value,
    sellerId: currentUser.uid,
    createdAt: serverTimestamp()
  });

  name.value = "";
  price.value = "";
  category.value = "";

  loadProducts();
};

/* LOAD PRODUCTS (CATEGORY-WISE) */
async function loadProducts() {
  const q = query(
    collection(db,"products"),
    where("sellerId","==",currentUser.uid)
  );

  const snap = await getDocs(q);
  productList.innerHTML = "";

  snap.forEach(d => {
    const p = d.data();

    if (!sellerCategoryFilter.value || p.category === sellerCategoryFilter.value) {
      productList.innerHTML += `
        <li>
          <b>${p.name}</b><br>
          â‚¹${p.price}<br>
          <small>${p.category}</small><br>
          <button class="danger" onclick="deleteProduct('${d.id}')">Delete</button>
        </li>`;
    }
  });

  if (!productList.innerHTML) {
    productList.innerHTML = "<li>No products in this category</li>";
  }
}

/* DELETE PRODUCT */
window.deleteProduct = async id => {
  if (!confirm("Delete this product?")) return;
  await deleteDoc(doc(db,"products",id));
  loadProducts();
};

/* LOAD ORDERS */
async function loadOrders() {
  const q = query(
    collection(db,"orders"),
    where("sellerId","==",currentUser.uid)
  );

  const snap = await getDocs(q);
  orderList.innerHTML = "";

  snap.forEach(d => {
    const o = d.data();

    let buttons = "";

    if (o.status === "pending") {
      buttons = `
        <button class="success" onclick="acceptOrder('${d.id}')">Accept</button>
        <button class="danger" onclick="rejectOrder('${d.id}')">Reject</button>
      `;
    }

    if (o.status === "accepted") {
      buttons = <button onclick="updateStatus('${d.id}','out for delivery')">Out for delivery</button>;
    }

    if (o.status === "out for delivery") {
      buttons = <button onclick="updateStatus('${d.id}','delivered')">Delivered</button>;
    }

    orderList.innerHTML += `
      <li>
        <b>${o.productName}</b><br>
        Status: ${o.status}<br>
        Payment: ${o.paymentMode}<br>
        Address: ${o.deliveryAddress}<br>
        ${buttons}
      </li>`;
  });
}

/* ACCEPT */
window.acceptOrder = async id => {
  await updateDoc(doc(db,"orders",id), { status:"accepted" });
  loadOrders();
};

/* REJECT */
window.rejectOrder = async id => {
  const reason = prompt("Reason (e.g. product out of stock)");
  if (!reason) return;

  await updateDoc(doc(db,"orders",id), {
    status:"rejected",
    rejectReason: "Sorry, " + reason
  });

  loadOrders();
};

/* UPDATE STATUS */
window.updateStatus = async (id,status) => {
  await updateDoc(doc(db,"orders",id), { status });
  loadOrders();
};

/* LOGOUT */
window.logout = () => {
  signOut(auth).then(() => location.href = "index.html");
};
</script>

</body>
</html>
